

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reproducible environments and dependencies &mdash; Reproducible research software development using Python (ML example)  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../_static/style.css?v=791bfbd6" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />

  
    <link rel="shortcut icon" href="../_static/coderefinery.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=35a8b989"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../_static/tabs.js?v=3030b3cb"></script>
      <script data-domain="coderefinery.github.io" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Notebooks and version control" href="../notebooks/version-control/" />
    <link rel="prev" title="How to contribute changes to repositories that belong to others" href="../collaboration/forking-workflow/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Reproducible research software development using Python (ML example)
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Software environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software install instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Episodes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../example/">Example project: 2D classification task using a nearest-neighbor predictor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../version-control/">Introduction to version control with Git and GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/">Where to start with documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collaboration/">Collaborative version control and code review</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reproducible environments and dependencies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-avoid-it-works-on-my-machine">How to avoid: ‚ÄúIt works on my machine ü§∑‚Äù</a></li>
<li class="toctree-l2"><a class="reference internal" href="#two-ecosystems-pypi-the-python-package-index-and-conda">Two ecosystems: PyPI (The Python Package Index) and Conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conda-ecosystem-explained">Conda ecosystem explained</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tools-and-distributions-for-dependency-management-in-python">Tools and distributions for dependency management in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#best-practice-install-dependencies-into-isolated-environments">Best practice: Install dependencies into isolated environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication">How to communicate the dependencies as part of a report/thesis/publication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#containers">Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-install-dependencies-into-environments">How to install dependencies into environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-environments">Updating environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pinning-package-versions">Pinning package versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#managing-dependencies-on-a-supercomputer">Managing dependencies on a supercomputer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/version-control/">Notebooks and version control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/tooling/">Other useful tooling for notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/sharing/">Sharing notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../good-practices/">Tools and useful practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling/">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/">Automated testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refactoring-concepts/">Concepts in refactoring and modular code design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakemake/">How to parallelize independent tasks using workflows (example: Snakemake)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software-licensing/">Choosing a software license</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/">How to publish your code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/">Creating a Python package and deploying it to PyPI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.github.io/reproducible-python-ml/lesson.pdf">PDF version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credit/">Credit</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/">All lessons</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/">CodeRefinery</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/reusing/">Reusing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Reproducible research software development using Python (ML example)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Reproducible environments and dependencies</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/reproducible-python-ml/blob/main/content/dependencies.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="reproducible-environments-and-dependencies">
<h1>Reproducible environments and dependencies<a class="headerlink" href="#reproducible-environments-and-dependencies" title="Link to this heading">ÔÉÅ</a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>There are not many codes that have no dependencies.
How should we <strong>deal with dependencies</strong>?</p></li>
<li><p>We will focus on installing and managing dependencies in Python when using packages from PyPI and Conda.</p></li>
<li><p>We will not discuss how to distribute your code as a package.</p></li>
</ul>
</div>
<p>[This episode borrows from <a class="reference external" href="https://coderefinery.github.io/reproducible-python/reusable/">https://coderefinery.github.io/reproducible-python/reusable/</a>
and <a class="reference external" href="https://aaltoscicomp.github.io/python-for-scicomp/dependencies/">https://aaltoscicomp.github.io/python-for-scicomp/dependencies/</a>]</p>
<p>Essential XKCD comics:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://xkcd.com/2347/">xkcd - dependency</a></p></li>
<li><p><a class="reference external" href="https://xkcd.com/1987/">xkcd - superfund</a></p></li>
</ul>
<section id="how-to-avoid-it-works-on-my-machine">
<h2>How to avoid: ‚ÄúIt works on my machine ü§∑‚Äù<a class="headerlink" href="#how-to-avoid-it-works-on-my-machine" title="Link to this heading">ÔÉÅ</a></h2>
<p>Use a <strong>standard way</strong> to list dependencies in your project:</p>
<ul class="simple">
<li><p>Python: <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code></p></li>
<li><p>R: <code class="docutils literal notranslate"><span class="pre">DESCRIPTION</span></code> or <code class="docutils literal notranslate"><span class="pre">renv.lock</span></code></p></li>
<li><p>Rust: <code class="docutils literal notranslate"><span class="pre">Cargo.lock</span></code></p></li>
<li><p>Julia: <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code></p></li>
<li><p>C/C++/Fortran: <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> or <code class="docutils literal notranslate"><span class="pre">spack.yaml</span></code> or the module
system on clusters or containers</p></li>
<li><p>Other languages: ‚Ä¶</p></li>
</ul>
</section>
<section id="two-ecosystems-pypi-the-python-package-index-and-conda">
<h2>Two ecosystems: PyPI (The Python Package Index) and Conda<a class="headerlink" href="#two-ecosystems-pypi-the-python-package-index-and-conda" title="Link to this heading">ÔÉÅ</a></h2>
<div class="admonition-pypi admonition">
<p class="admonition-title">PyPI</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">uv</span></code> or similar</p></li>
<li><p>Traditionally used for Python-only packages or
for Python interfaces to external libraries. There are also packages
that have bundled external libraries (such as numpy).</p></li>
<li><p><strong>Pros:</strong></p>
<ul>
<li><p>Easy to use</p></li>
<li><p>Package creation is easy</p></li>
</ul>
</li>
<li><p><strong>Cons:</strong></p>
<ul>
<li><p>Installing packages that need external libraries can be complicated</p></li>
</ul>
</li>
</ul>
</div>
<div class="admonition-conda admonition">
<p class="admonition-title">Conda</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <code class="docutils literal notranslate"><span class="pre">conda</span></code> or <code class="docutils literal notranslate"><span class="pre">mamba</span></code> or similar</p></li>
<li><p>Aims to be a more general package distribution tool
and it tries to provide not only the Python packages, but also libraries
and tools needed by the Python packages.</p></li>
<li><p><strong>Pros:</strong></p>
<ul>
<li><p>Quite easy to use</p></li>
<li><p>Easier to manage packages that need external libraries</p></li>
<li><p>Not only for Python</p></li>
</ul>
</li>
<li><p><strong>Cons:</strong></p>
<ul>
<li><p>Package creation is harder</p></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="conda-ecosystem-explained">
<h2>Conda ecosystem explained<a class="headerlink" href="#conda-ecosystem-explained" title="Link to this heading">ÔÉÅ</a></h2>
<ul>
<li><p><a class="reference external" href="https://www.anaconda.com">Anaconda</a> is a distribution of conda packages
made by Anaconda Inc. When using Anaconda remember to check that your
situation abides with their licensing terms (see below).</p></li>
<li><p>Anaconda has recently changed its <strong>licensing terms</strong>, which affects its
use in a professional setting. This caused uproar among academia
and Anaconda modified their position in
<a class="reference external" href="https://www.anaconda.com/blog/update-on-anacondas-terms-of-service-for-academia-and-research">this article</a>.</p>
<p>Main points of the article are:</p>
<ul class="simple">
<li><p>conda (installation tool) and community channels (e.g. conda-forge)
are free to use.</p></li>
<li><p>Anaconda repository and <strong>Anaconda‚Äôs channels in the community repository</strong>
are free for universities and companies with fewer than 200 employees.
Non-university research institutions and national laboratories need
licenses.</p></li>
<li><p>Miniconda is free, when it does not download Anaconda‚Äôs packages.</p></li>
<li><p>Miniforge is not related to Anaconda, so it is free.</p></li>
</ul>
<p>For ease of use on sharing environment files, we recommend using
Miniforge to create the environments and using conda-forge as the main
channel that provides software.</p>
</li>
<li><p>Major repositories/channels:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://repo.anaconda.com">Anaconda Repository</a>
houses Anaconda‚Äôs own proprietary software channels.</p></li>
<li><p>Anaconda‚Äôs proprietary channels: <code class="docutils literal notranslate"><span class="pre">main</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">msys2</span></code> and <code class="docutils literal notranslate"><span class="pre">anaconda</span></code>.
These are sometimes called <code class="docutils literal notranslate"><span class="pre">defaults</span></code>.</p></li>
<li><p><a class="reference external" href="https://conda-forge.org">conda-forge</a> is the largest open source
community channel. It has over 28k packages that include open-source
versions of packages in Anaconda‚Äôs channels.</p></li>
</ul>
</li>
</ul>
</section>
<section id="tools-and-distributions-for-dependency-management-in-python">
<h2>Tools and distributions for dependency management in Python<a class="headerlink" href="#tools-and-distributions-for-dependency-management-in-python" title="Link to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://python-poetry.org">Poetry</a>: Dependency management and packaging.</p></li>
<li><p><a class="reference external" href="https://pipenv.pypa.io">Pipenv</a>: Dependency management, alternative to Poetry.</p></li>
<li><p><a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>: If you need different Python versions for different projects.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/venv.html">virtualenv</a>: Tool to create isolated Python environments for PyPI packages.</p></li>
<li><p><a class="reference external" href="https://github.com/thoth-station/micropipenv">micropipenv</a>: Lightweight tool to ‚Äúrule them all‚Äù.</p></li>
<li><p><a class="reference external" href="https://docs.conda.io">Conda</a>: Package manager for Python and other languages maintained by Anaconda Inc.</p></li>
<li><p><a class="reference external" href="https://docs.anaconda.com/miniconda/">Miniconda</a>: A ‚Äúminiature‚Äù version of conda, maintained by Anaconda Inc. By default uses
Anaconda‚Äôs channels. Check licensing terms when using these packages.</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io">Mamba</a>: A drop in replacement for conda.
It used be much faster than conda due to better
dependency solver but nowadays conda
<a class="reference external" href="https://conda.org/blog/2023-11-06-conda-23-10-0-release/">also uses the same solver</a>.
It still has some UI improvements.</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">Micromamba</a>: Tiny version of the Mamba package manager.</p></li>
<li><p><a class="reference external" href="https://github.com/conda-forge/miniforge">Miniforge</a>: Open-source Miniconda alternative with
conda-forge as the default channel and optionally mamba as the default installer.</p></li>
<li><p><a class="reference external" href="https://pixi.sh">Pixi</a>: Modern, super fast tool which can manage conda environments.</p></li>
<li><p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a>: Modern, super fast replacement for pip,
poetry, pyenv, and virtualenv. You can also switch between Python versions.</p></li>
</ul>
</section>
<section id="best-practice-install-dependencies-into-isolated-environments">
<h2>Best practice: Install dependencies into isolated environments<a class="headerlink" href="#best-practice-install-dependencies-into-isolated-environments" title="Link to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p>For each project, create a <strong>separate environment</strong>.</p></li>
<li><p>Don‚Äôt install dependencies globally for all projects. Sooner or later, different projects will have conflicting dependencies.</p></li>
<li><p>Install them <strong>from a file</strong> which documents them at the same time
Install dependencies by first recording them in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> and install using these files, then you have a trace
(we will practice this later below).</p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<p>If somebody asks you what dependencies you have in your project, you should be
able to answer this question <strong>with a file</strong>.</p>
<p>In Python, the two most common ways to do this are:</p>
<ul class="simple">
<li><p><strong>requirements.txt</strong> (for pip and virtual environments)</p></li>
<li><p><strong>environment.yml</strong> (for conda and similar)</p></li>
<li><p><strong>pyproject.toml</strong> (for uv, poetry and similar)</p></li>
</ul>
<p>You can export (‚Äúfreeze‚Äù) the dependencies from your current environment into these files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># inside a conda environment</span>
$<span class="w"> </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--from-history<span class="w"> </span>&gt;<span class="w"> </span>environment.yml

<span class="c1"># inside a virtual environment</span>
$<span class="w"> </span>pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</pre></div>
</div>
</div>
</section>
<section id="how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication">
<h2>How to communicate the dependencies as part of a report/thesis/publication<a class="headerlink" href="#how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication" title="Link to this heading">ÔÉÅ</a></h2>
<p>Each notebook or script or project which depends on libraries should come with
either a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>, unless you are creating
and distributing this project as Python package.</p>
<ul class="simple">
<li><p>Attach a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> to your thesis.</p></li>
<li><p>Even better: Put <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> in your Git repository along your code.</p></li>
<li><p>Even better: Also <a class="reference external" href="https://mybinder.org/">binderize</a> your analysis pipeline.</p></li>
</ul>
</section>
<section id="containers">
<h2>Containers<a class="headerlink" href="#containers" title="Link to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p>A container is like an <strong>operating system inside a file</strong>.</p></li>
<li><p>‚ÄúBuilding a container‚Äù: Container definition file (recipe) -&gt; Container image</p></li>
<li><p>This can be used with <a class="reference external" href="https://apptainer.org/">Apptainer</a>/
<a class="reference external" href="https://sylabs.io/singularity/">SingularityCE</a>.</p></li>
</ul>
<p>Containers offer the following advantages:</p>
<ul class="simple">
<li><p><strong>Reproducibility</strong>: The same software environment can be recreated (most of the time) on
different computers. They force you to know and <strong>document all your dependencies</strong>.</p></li>
<li><p><strong>Portability</strong>: The same software environment can be run (most of the time) on different computers.</p></li>
<li><p><strong>Isolation</strong>: The software environment is isolated from the host system.</p></li>
<li><p>‚Äú<strong>Time travel</strong>‚Äù:</p>
<ul>
<li><p>You can run old/unmaintained software on new systems.</p></li>
<li><p>Code that needs new dependencies which are not available on old systems can
still be run on old systems.</p></li>
</ul>
</li>
</ul>
</section>
<section id="how-to-install-dependencies-into-environments">
<h2>How to install dependencies into environments<a class="headerlink" href="#how-to-install-dependencies-into-environments" title="Link to this heading">ÔÉÅ</a></h2>
<p>Now we understand a bit better why and how we installed dependencies
for this course in the <a class="reference internal" href="../installation/"><span class="doc">Software install instructions</span></a>.</p>
<p>We have used <strong>Miniforge</strong> and the long command we have used was:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mamba<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>course<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/coderefinery/reproducible-python-ml/main/software/environment.yml
</pre></div>
</div>
<p>This command did two things:</p>
<ul class="simple">
<li><p>Create a new environment with name ‚Äúcourse‚Äù (specified by <code class="docutils literal notranslate"><span class="pre">-n</span></code>).</p></li>
<li><p>Installed all dependencies listed in the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file (specified by
<code class="docutils literal notranslate"><span class="pre">-f</span></code>), which we fetched directly from the web.
<a class="reference external" href="https://github.com/coderefinery/reproducible-python-ml/blob/main/software/environment.yml">Here</a>
you can browse it.</p></li>
</ul>
<p>For your own projects:</p>
<ol class="arabic simple">
<li><p>Start by writing an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> of <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file. They look like this:</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">environment.yml</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">requirements.txt</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">course</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bioconda</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python &lt;= 3.12</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">click</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scipy</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">altair</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vl-convert-python</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jupyterlab</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scalene</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flit</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ruff</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">icecream</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snakemake-minimal</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myst-parser</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sphinx</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sphinx-rtd-theme</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sphinx-autoapi</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sphinx-autobuild</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">black</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">isort</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pip</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jupyterlab-code-formatter</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">click</span>
<span class="n">numpy</span>
<span class="n">pandas</span>
<span class="n">scipy</span>
<span class="n">altair</span>
<span class="n">vl</span><span class="o">-</span><span class="n">convert</span><span class="o">-</span><span class="n">python</span>
<span class="n">jupyterlab</span>
<span class="n">pytest</span>
<span class="n">scalene</span>
<span class="n">flit</span>
<span class="n">ruff</span>
<span class="n">icecream</span>
<span class="n">myst</span><span class="o">-</span><span class="n">parser</span>
<span class="n">sphinx</span>
<span class="n">sphinx</span><span class="o">-</span><span class="n">rtd</span><span class="o">-</span><span class="n">theme</span>
<span class="n">sphinx</span><span class="o">-</span><span class="n">autoapi</span>
<span class="n">sphinx</span><span class="o">-</span><span class="n">autobuild</span>
<span class="n">black</span>
<span class="n">isort</span>
<span class="n">jupyterlab</span><span class="o">-</span><span class="n">code</span><span class="o">-</span><span class="n">formatter</span>
</pre></div>
</div>
</div></div>
<ol class="arabic simple" start="2">
<li><p>Then set up an isolated environment and install the dependencies from the file into it:</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-1-UGl4aQ==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-UGl4aQ==" name="UGl4aQ==" role="tab" tabindex="-1">Pixi</button><button aria-controls="panel-1-VmlydHVhbCBlbnZpcm9ubWVudA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-VmlydHVhbCBlbnZpcm9ubWVudA==" name="VmlydHVhbCBlbnZpcm9ubWVudA==" role="tab" tabindex="-1">Virtual environment</button><button aria-controls="panel-1-dXY=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-dXY=" name="dXY=" role="tab" tabindex="-1">uv</button></div><div aria-labelledby="tab-1-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-1-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><ul>
<li><p>Create a new environment with name ‚Äúmyenv‚Äù from <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>myenv<span class="w"> </span>-f<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mamba<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>myenv<span class="w"> </span>-f<span class="w"> </span>environment.yml
</pre></div>
</div>
</li>
<li><p>Activate the environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>myenv
</pre></div>
</div>
</li>
<li><p>Run your code inside the activated virtual environment.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>example.py
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-1-UGl4aQ==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-UGl4aQ==" name="UGl4aQ==" role="tabpanel" tabindex="0"><ul>
<li><p>Create <code class="docutils literal notranslate"><span class="pre">pixi.toml</span></code> from <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pixi<span class="w"> </span>init<span class="w"> </span>--import<span class="w"> </span>environment.yml
</pre></div>
</div>
</li>
<li><p>Run your code inside the environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pixi<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>example.py
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-1-VmlydHVhbCBlbnZpcm9ubWVudA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-VmlydHVhbCBlbnZpcm9ubWVudA==" name="VmlydHVhbCBlbnZpcm9ubWVudA==" role="tabpanel" tabindex="0"><ul>
<li><p>Create a virtual environment by running (the second argument is the name
of the environment and you can change it):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
</pre></div>
</div>
</li>
<li><p>Activate the virtual environment (how precisely depends on your operating
system and shell).</p></li>
<li><p>Install the dependencies:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
</li>
<li><p>Run your code inside the activated virtual environment.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>example.py
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-1-dXY=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-dXY=" name="dXY=" role="tabpanel" tabindex="0"><ul>
<li><p>Create a virtual environment by running (the second argument is the name
of the environment and you can change it):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>uv<span class="w"> </span>venv<span class="w"> </span>venv
</pre></div>
</div>
</li>
<li><p>Activate the virtual environment (how precisely depends on your operating
system and shell).</p></li>
<li><p>Install the dependencies:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>uv<span class="w"> </span>pip<span class="w"> </span>sync<span class="w"> </span>requirements.txt
</pre></div>
</div>
</li>
<li><p>Run your code inside the virtual environment.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>uv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>example.py
</pre></div>
</div>
</li>
</ul>
</div></div>
</section>
<section id="updating-environments">
<h2>Updating environments<a class="headerlink" href="#updating-environments" title="Link to this heading">ÔÉÅ</a></h2>
<p>What if you forgot a dependency? Or during the development of your project
you realize that you need a new dependency? Or you don‚Äôt need some dependency anymore?</p>
<ol class="arabic simple">
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.</p></li>
<li><p>Either remove your environment and create a new one, or update the existing one:</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-2-UGl4aQ==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-UGl4aQ==" name="UGl4aQ==" role="tab" tabindex="-1">Pixi</button><button aria-controls="panel-2-VmlydHVhbCBlbnZpcm9ubWVudA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-VmlydHVhbCBlbnZpcm9ubWVudA==" name="VmlydHVhbCBlbnZpcm9ubWVudA==" role="tab" tabindex="-1">Virtual environment</button><button aria-controls="panel-2-dXY=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-dXY=" name="dXY=" role="tab" tabindex="-1">uv</button></div><div aria-labelledby="tab-2-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-2-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><ul>
<li><p>Update the environment by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>update<span class="w"> </span>--file<span class="w"> </span>environment.yml
</pre></div>
</div>
</li>
<li><p>Or equivalently:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mamba<span class="w"> </span>env<span class="w"> </span>update<span class="w"> </span>--file<span class="w"> </span>environment.yml
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-2-UGl4aQ==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-UGl4aQ==" name="UGl4aQ==" role="tabpanel" tabindex="0"><ul>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">pixi.toml</span></code>.</p></li>
<li><p>Then update it from the updated <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pixi<span class="w"> </span>init<span class="w"> </span>--import<span class="w"> </span>environment.yml
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-2-VmlydHVhbCBlbnZpcm9ubWVudA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-VmlydHVhbCBlbnZpcm9ubWVudA==" name="VmlydHVhbCBlbnZpcm9ubWVudA==" role="tabpanel" tabindex="0"><ul>
<li><p>Activate the virtual environment.</p></li>
<li><p>Update the environment by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-2-dXY=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-dXY=" name="dXY=" role="tabpanel" tabindex="0"><ul>
<li><p>Activate the virtual environment.</p></li>
<li><p>Update the environment by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>uv<span class="w"> </span>pip<span class="w"> </span>sync<span class="w"> </span>requirements.txt
</pre></div>
</div>
</li>
</ul>
</div></div>
</section>
<section id="pinning-package-versions">
<h2>Pinning package versions<a class="headerlink" href="#pinning-package-versions" title="Link to this heading">ÔÉÅ</a></h2>
<p>Let us look at the
<a class="reference external" href="https://github.com/coderefinery/reproducible-python-ml/blob/main/software/environment.yml">environment.yml</a>
which we used to set up the environment for this course.
Dependencies are listed without version numbers. Should we <strong>pin the
versions</strong>?</p>
<ul class="simple">
<li><p>Both <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">conda</span></code> ecosystems and all the tools that we have
mentioned support pinning versions.</p></li>
<li><p>It is possible to define a range of versions instead of precise versions.</p></li>
<li><p>While your project is still in progress, I often use latest versions and do not pin them.</p></li>
<li><p>When publishing the script or notebook, it is a good idea to pin the versions
to ensure that the code can be run in the future.</p></li>
<li><p>Remember that at some point in time you will face a situation where
newer versions of the dependencies are no longer compatible with your
software. At this point you‚Äôll have to update your software to use the newer
versions or to lock it into a place in time.</p></li>
</ul>
</section>
<section id="managing-dependencies-on-a-supercomputer">
<h2>Managing dependencies on a supercomputer<a class="headerlink" href="#managing-dependencies-on-a-supercomputer" title="Link to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p>Additional challenges:</p>
<ul>
<li><p>Storage quotas: <strong>Do not install dependencies in your home directory</strong>. A conda environment can easily contain 100k files.</p></li>
<li><p>Network file systems struggle with many small files. Conda environments often contain many small files.</p></li>
</ul>
</li>
<li><p>Possible solutions:</p>
<ul>
<li><p>Try <a class="reference external" href="https://pixi.sh/">Pixi</a> (modern take on managing Conda environments) and
<a class="reference external" href="https://docs.astral.sh/uv/">uv</a> (modern take on managing virtual
environments). Blog post: <a class="reference external" href="https://research-software.uit.no/blog/2025-pixi-and-uv/">Using Pixi and uv on a supercomputer</a></p></li>
<li><p>Install your environment on the fly into a scratch directory on local disk (<strong>not</strong> the network file system).</p></li>
<li><p>Install your environment on the fly into a RAM disk/drive.</p></li>
<li><p>Containerize your environment into a container image.</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
<div class="admonition-keypoints keypoints admonition" id="keypoints-1">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Being able to communicate your dependencies is not only nice for others, but
also for your future self or the next PhD student or post-doc.</p></li>
<li><p>If you ask somebody to help you with your code, they will ask you for the
dependencies.</p></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../collaboration/forking-workflow/" class="btn btn-neutral float-left" title="How to contribute changes to repositories that belong to others" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../notebooks/version-control/" class="btn btn-neutral float-right" title="Notebooks and version control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright CodeRefinery contributors (CC-BY license).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>